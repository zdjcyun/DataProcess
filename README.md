# DataProcess

åŸºäºå¤§æ•°æ®å¹³å°çš„æ•°æ®å¤„ç†æœåŠ¡æ¡†æ¶:fire:
> Make big data processing more convenient

## :clipboard: ä»€ä¹ˆæ˜¯DataProcess

ç»“åˆå¤§æ•°æ®é¡¹ç›®å®é™…ä½¿ç”¨åœºæ™¯ï¼Œæå–å‡ºçš„ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œå½¢æˆå¤§æ•°æ®å¹³å°æ•°æ®å¤„ç†æ¡†æ¶ã€‚

ç›®å‰ä¸»è¦å®ç°çš„åŠŸèƒ½æœ‰ï¼š  

- å‚æ•°ä¿¡æ¯é…ç½®æ¨¡å—ï¼Œå¯å®ç°é‡‡ç”¨æ•°æ®åº“è¿›è¡Œé…ç½®å’ŒPropertiesæ–‡ä»¶è¿›è¡Œé…ç½®
- é›†æˆKafkaï¼Œå®ç°äº†Kafkaçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ç›¸å…³çš„åŠŸèƒ½
- é›†æˆMongoDBï¼Œå®ç°äº†MongoDBçš„æ•°æ®è¯»å–ã€å†™å…¥ç­‰ï¼Œå®ç°äº†SparkSQLé€šè¿‡DataFrameä¸MongoDBçš„æ•°æ®è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸”å®ç°äº†åˆ†é¡µè¯»å–ã€æµå¼è¯»å–ç­‰ç‰¹æ®Šè¯»å–æ–¹å¼
- é›†æˆRedisï¼Œå®ç°äº†Redisçš„è¯»å–ã€å†™å…¥ç­‰ï¼Œå®ç°äº†SparkSQLé€šè¿‡DataFrameä¸Redisçš„æ•°æ®è¿›è¡Œäº¤äº’
- SparkStreamingæµå¼å¤„ç†Kafkaã€MongoDBçš„æ•°æ®
- æ‰‹åŠ¨è®°å½•Kafkaçš„åç§»é‡ï¼Œå®ç°äº†åŸºäºæ•°æ®åº“è¿›è¡Œè®°å½•å’ŒåŸºäºZookeeperè¿›è¡Œè®°å½•
- é›†æˆäº†è§„åˆ™å¼•æ“ï¼Œå®¢æˆ·æ ‡ç­¾ã€å®¢æˆ·ç”»åƒç­‰åŠŸèƒ½å¯åŸºäºè§„åˆ™å¼•æ“è¿›è¡Œå®ç°

## :airplane: è½¯ä»¶æ¶æ„

è½¯ä»¶ç»“æ„å¦‚ä¸‹ï¼š  
```
DataProcess      é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ commons             å…¬å…±åŠŸèƒ½æ¨¡å—ï¼Œæä¾›é…ç½®æ–‡ä»¶è¯»å–ã€æ•°æ®åº“è¿æ¥ã€æ—¥å¿—æ‰“å°ã€å·¥å…·ç±»ç­‰å…¬å…±åŠŸèƒ½ï¼Œä»¥ä¾›å…¶ä»–æ¨¡å—è°ƒç”¨ã€‚  
â”œâ”€â”€ examples            æ ·ä¾‹æ¨¡å—ï¼Œæä¾›å„ä¸ªåŠŸèƒ½ç‚¹çš„æ ·ä¾‹ä»£ç ã€‚  
â”œâ”€â”€ kafka-clients       KafkaClientsç›¸å…³åŠŸèƒ½ï¼Œæ¯”å¦‚ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ç­‰ã€‚
â”œâ”€â”€ kafka-streams       ä¸»é¢˜æ•°æ®è¿‡æ»¤æ¨¡å—
â”œâ”€â”€ rule-engine         è§„åˆ™å¼•æ“åŠŸèƒ½ã€‚
â”œâ”€â”€ spark-sql           SparkSQLç›¸å…³åŠŸèƒ½ï¼Œæ‰©å±•äº†Dataset/DataFrameçš„æ–¹æ³•ï¼Œé›†æˆRedisæ•°æ®çš„è¯»å†™ã€MongoDBæ•°æ®çš„è¯»å†™ã€‚  
â”œâ”€â”€ spark-streaming     SparkStreamingå®æ—¶æ•°æ®å¤„ç†æ¨¡å—ï¼Œé€šè¿‡SparkStreamingç¨‹åºï¼Œå‡†å®æ—¶æ¶ˆè´¹Kafkaä¸­çš„æ•°æ®ï¼Œæµå¼æ–¹å¼å¤„ç†MongoDBä¸­çš„æ•°æ®ã€‚
â””â”€â”€ third-party         ç¬¬ä¸‰æ–¹æºç 
      â”œâ”€â”€ hammurabi     Scalaè§„åˆ™å¼•æ“
      â”œâ”€â”€ mongodb       Sparkæ“ä½œMongoDB
      â””â”€â”€ redislabs     Sparkæ“ä½œRedis
```

> **skafka-treamsè¯´æ˜**
>
> ä¸»é¢˜æ•°æ®è¿‡æ»¤æ¨¡å—ï¼ŒKafkaè‡ªå¸¦çš„æµå¤„ç†åŠŸèƒ½ï¼Œä¸šåŠ¡ç³»ç»Ÿè®°å½•çš„æ—¥å¿—å¦‚æœåŒ…å«äº†å¤§é‡çš„ï¼šç¨‹åºå¼‚å¸¸æ—¥å¿—ã€æ•°æ®åº“æ“ä½œæ—¥å¿—ã€è°ƒè¯•æ—¥å¿—ç­‰æ—¥å¿—ä¿¡æ¯ã€‚
>
> è€Œé‡‡é›†çš„æ•°æ®åªéœ€è¦æ—¥å¿—æ–‡ä»¶ä¸­çš„ç‰¹å®šæ•°æ®çš„æ—¥å¿—è®°å½•ï¼Œé‚£ä¹ˆå¯¹äºæˆ‘ä»¬é‡‡é›†åˆ°çš„æ—¥å¿—æ¥è¯´ï¼Œå¯èƒ½ä¼šæœ‰90%ä»¥ä¸Šçš„æ—¥å¿—éƒ½æ˜¯åƒåœ¾æ•°æ®ï¼Œä½†æ˜¯Flumeç»„ä»¶æ²¡æœ‰æä¾›æ—¥å¿—è¿‡æ»¤åŠŸèƒ½ï¼Œè€ŒSparkç¨‹åºåˆä¸åº”è¯¥æ¶ˆè´¹è¿™äº›æ•°æ®ã€‚
>
> è¿™æ—¶å°±éœ€è¦æä¾›ä¸€ä¸ªä¸­é—´å±‚ï¼Œå°†Flumeé‡‡é›†åˆ°çš„Topic1çš„æ—¥å¿—ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®ç­›é€‰å‡ºæ¥æ”¾åˆ°Topic2ä¸­ï¼ŒSparkç¨‹åºåªéœ€è¦æ¶ˆè´¹Topic2çš„æ•°æ®å³å¯ï¼Œè¿‡æ»¤æ¡ä»¶æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œé…ç½®ã€‚è¿™æ ·Sparkæ¶ˆè´¹Topic2çš„æ•°æ®éƒ½æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åŠæ—¶çš„æ¸…ç†æ‰Topic1çš„æ•°æ®ä»¥é‡Šæ”¾ç©ºé—´ã€‚

## :microphone: ä½¿ç”¨è¯´æ˜

###  :blush:å¼€å‘ç¯å¢ƒå‡†å¤‡

è¿™é‡Œä»¥Intellij IDEAä¸ºä¾‹ã€‚

æ‰“å¼€IDEAï¼ŒFile -> Import Projectâ€¦ï¼Œé€‰æ‹©é¡¹ç›®ç›®å½•DataService-FusionInsightä¸‹çš„pom.xmlï¼Œæ‰“å¼€é¡¹ç›®ã€‚

![028](works/images/028.png) 

æ‰“å¼€äº†é¡¹ç›®ä¹‹åï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½ï¼Œé‡‡ç”¨Javaæˆ–Scalaè¯­è¨€è¿›è¡ŒåŠŸèƒ½å¼€å‘ã€æ‰©å±•ã€‚

### :pencil2: â€‹åŠŸèƒ½æ‰©å±•

ç›®å‰ï¼Œè½¯ä»¶å®ç°äº†Flumeæ•°æ®é‡‡é›†ã€Kafkaä¸»é¢˜æ•°æ®è¿‡æ»¤ã€SparkStreamingå®æ—¶æ•°æ®å¤„ç†ã€‚

ä½†æ˜¯SparkStreamingçš„æ•°æ®å¤„ç†åªå®ç°äº†ä»£ç å€¼æ ‡å‡†åŒ–ç­‰åŸºç¡€åŠŸèƒ½ã€‚

ç›®å‰é»˜è®¤æ”¯æŒçš„é‡‡é›†æ—¥å¿—æ ¼å¼åªæœ‰ä¸¤ç§ï¼šåˆ†éš”ç¬¦åˆ†éš”å­—æ®µçš„æ•°æ®ã€JSONæ ¼å¼çš„æ•°æ®ã€‚

åŠŸèƒ½æ‰©å±•å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢è¿›è¡Œï¼š

- SparkStreamingç¨‹åºæ‰©å±•ï¼Œå¯ä»¥ç»§ç»­å¢åŠ ç¨‹åºå¤„ç†åŠŸèƒ½ï¼Œå®Œæˆæ›´å¤æ‚çš„æ•°æ®å¤„ç†ï¼Œæ¯”å¦‚ï¼šæŒ‡æ ‡åŠ å·¥ã€å®¢æˆ·è¡Œä¸ºåˆ†æã€å®¢æˆ·ç”»åƒç­‰
- æ—¥å¿—æ ¼å¼æ‰©å±•ï¼Œç›®å‰åªå¼€å‘äº†æ”¯æŒä¸¤ç§ç±»å‹çš„æ—¥å¿—æ ¼å¼ï¼Œå¯ä»¥è‡ªå®šä¹‰ç±»å®ç°com.service.data.spark.streaming.process.TopicValueProcessæ¥å£ï¼Œä»¥å®ç°å…¶ä»–æ ¼å¼çš„æ—¥å¿—å†…å®¹çš„è§£æã€‚è‡ªå®šä¹‰å®ç°ç±»åï¼Œéœ€è¦åœ¨spark-kafkaæ¨¡å—çš„resources/META-INF/services/com.service.data.spark.streaming.process.TopicValueProcessæ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œè®°å½•ç±»åç§°ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°†å…¶é…ç½®åˆ°æ•°æ®åº“ä¸­å³å¯ã€‚

![029](works/images/029.png)

è‡ªå®šä¹‰ç±»ç¼–å†™å®Œæˆåï¼Œéœ€è¦åœ¨æŒ‡å®šæ–‡ä»¶ä¸­æ·»åŠ å®ç°ç±»çš„åç§°ã€‚

![030](works/images/030.png)

è¿™ä¸ªè‡ªå®šä¹‰ç±»åï¼Œç”¨äºåœ¨é…ç½®è¡¨ä¸­é…ç½®ï¼Œæœ€ç»ˆå®ç°ç”¨è¯¥ç±»è§£æå¯¹åº”çš„Topicçš„æ•°æ®ã€‚

![031](works/images/020.png)

###  :cat:ç¨‹åºè¿è¡Œ

#### **:one: **æ•°æ®æºè®¾ç½®

åœ¨è¿è¡Œç¨‹åºä¹‹å‰ï¼Œéœ€è¦è®¾ç½®é…ç½®ä¿¡æ¯æ‰€åœ¨çš„æ•°æ®åº“çš„æ•°æ®æºï¼Œä»¥åŠSparkStreamingç¨‹åºå¤„ç†åçš„æ•°æ®çš„æœ€ç»ˆè½åœ°çš„æ•°æ®åº“æ•°æ®æºä¿¡æ¯ã€‚ä¸»è¦ä¿®æ”¹çš„æ˜¯commonsä¸‹çš„db.propertiesæ–‡ä»¶ï¼Œä¿®æ”¹é‡Œé¢çš„æ•°æ®åº“é©±åŠ¨ã€è¿æ¥ã€ç”¨æˆ·ã€å¯†ç ç­‰ä¿¡æ¯ã€‚

![031](works/images/031.png)

å…¶ä¸­ï¼š

- db.config.* é…ç½®çš„æ˜¯é…ç½®ä¿¡æ¯æ‰€åœ¨çš„æ•°æ®åº“çš„æ•°æ®æºï¼Œå³InitData.sqlä¸­çš„è¡¨æ‰€åœ¨çš„æ•°æ®åº“ä¿¡æ¯ã€‚

- db.mysql.*/db.oracle.*/db.other.* æ ¹æ®å®é™…éœ€æ±‚é…ç½®å¤šæ•°æ®æºï¼Œå³SparkStreamingç¨‹åºå¤„ç†æ•°æ®åéœ€è¦è½åœ°åˆ°å“ªäº›æ•°æ®åº“ã€‚

- æ®æºé…ç½®ä¿¡æ¯ä¸­ï¼Œç”¨æˆ·åã€å¯†ç æ˜¯éœ€è¦åŠ å¯†å¤„ç†çš„ï¼Œä½¿ç”¨commonsçš„testä¸‹çš„TestEncryptè¿›è¡Œç”¨æˆ·å¯†ç çš„åŠ å¯†ï¼Œå¹¶å°†åŠ å¯†åçš„å­—ç¬¦ä¸²å¤åˆ¶å¡«å……åˆ°é…ç½®æ–‡ä»¶é‡Œå³å¯ã€‚

![031](works/images/032.png)



#### **:two: **æœ¬åœ°è¿è¡Œ

SparkStreamingç¨‹åºè¦åœ¨æœ¬åœ°è¿è¡Œï¼Œéœ€è¦æŒ‡å®šmasterï¼Œå¯ä»¥è®¾ç½®ä¸ºlocal[2]ã€‚

![031](works/images/033.png)

å¹¶ä¸”éœ€è¦å°†pom.xmlä¸­çš„ä¾èµ–çš„providedæ³¨é‡Šæ‰ï¼Œä»¥ä¿è¯ä¾èµ–ä¸­æœ‰Sparkç›¸å…³çš„åº“ã€‚

![031](works/images/034.png)

ç„¶åç›´æ¥è¿è¡ŒStreamingFromKafkaç±»å³å¯ã€‚

#### **:three:** æ‰“åŒ…éƒ¨ç½²

æœ€ç»ˆçš„SparkStreamingç¨‹åºå°†è¿è¡Œåœ¨Yarnä¸Šï¼Œå› æ­¤éœ€è¦å°†masterè®¾ç½®å»æ‰ã€‚

![031](works/images/035.png)

å¹¶ä¸”ä¸ºäº†å‡å°JaråŒ…çš„å¤§å°ï¼Œåœ¨æ‰“åŒ…çš„æ—¶å€™å¯ä»¥æ’é™¤æ‰é›†ç¾¤ç¯å¢ƒä¸­å·²æœ‰çš„Jarçš„ä¾èµ–ã€‚

![031](works/images/036.png)

æ‰“å¼€Project Structureï¼Œåœ¨Artifactsä¸­é€‰æ‹©â€œ+â€ï¼Œå¹¶é€‰æ‹©ä»å·²æœ‰æ¨¡å—æ·»åŠ ã€‚

![031](works/images/037.png)

é€‰æ‹©spark-kafkaæ¨¡å—ã€‚

![031](works/images/038.png)

åœ¨é…ç½®ä¸­å°†spark-kafkaè®¾ç½®ä¸ºPut into Output Rootã€‚

![031](works/images/039.png)

é€šè¿‡Build â€“> Build Artifactsâ€¦

![031](works/images/040.png)

é€‰æ‹©Buildè¿›è¡Œç¼–è¯‘æ‰“åŒ…ã€‚

![031](works/images/041.png)

æœ€åï¼Œåœ¨outç›®å½•ä¸‹æœ‰ä¸€ä¸ªspark-kafka.jarçš„è½¯ä»¶åŒ…ã€‚

![031](works/images/042.png)

è¿™ä¸ªåŒ…å°±æ˜¯æ‰“åŒ…åçš„æœ€ç»ˆç»“æœï¼Œå¯ä»¥ç›´æ¥æäº¤åˆ°Yarnä¸Šè¿è¡Œã€‚

> PSï¼šæ›´å¤šä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ä¸‹æ–¹æ–‡æ¡£

- æ•°æ®ç«¯é…ç½®å·¥å…·ï¼š[æ•°æ®ç«¯é…ç½®å·¥å…·.xlsx](works/docs/%E6%95%B0%E6%8D%AE%E7%AB%AF%E9%85%8D%E7%BD%AE%E5%B7%A5%E5%85%B7.xlsx) 

- ç¯å¢ƒæ­å»ºéƒ¨ç½²æ–‡æ¡£ï¼š[ç¯å¢ƒæ­å»ºéƒ¨ç½²æ–‡æ¡£.docx](works/docs/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3.docx)  


##  ğŸ¤ å¦‚ä½•è´¡çŒ®

[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square)](https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fstreamxhub%2Fstreamx%2Fpulls)

å¦‚æœä½ å¸Œæœ›å‚ä¸è´¡çŒ® æ¬¢è¿ `Pull Request`ï¼Œæˆ–ç»™æˆ‘ä»¬ `æŠ¥å‘Š Bug`ã€‚

> å¼ºçƒˆæ¨èé˜…è¯» [ã€Šæé—®çš„æ™ºæ…§ã€‹](https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Fryanhanwu%2FHow-To-Ask-Questions-The-Smart-Way)(**æœ¬æŒ‡å—ä¸æä¾›æ­¤é¡¹ç›®çš„å®é™…æ”¯æŒæœåŠ¡ï¼**)ã€[ã€Šå¦‚ä½•æœ‰æ•ˆåœ°æŠ¥å‘Š Bugã€‹](https://gitee.com/link?target=http%3A%2F%2Fwww.chiark.greenend.org.uk%2F%7Esgtatham%2Fbugs-cn.html)ã€[ã€Šå¦‚ä½•å‘å¼€æºé¡¹ç›®æäº¤æ— æ³•è§£ç­”çš„é—®é¢˜ã€‹](https://gitee.com/link?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F25795393)ï¼Œæ›´å¥½çš„é—®é¢˜æ›´å®¹æ˜“è·å¾—å¸®åŠ©ã€‚

æ„Ÿè°¢æ‰€æœ‰å‘ DataProcessè´¡çŒ®çš„æœ‹å‹!


